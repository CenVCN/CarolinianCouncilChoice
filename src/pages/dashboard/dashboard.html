<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="dashboard_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <nav class="navBar">
        <ul class = "leftLinks">
            <li><img src = "..\..\components\Images\LogoCCC.png" alt="Logo" class="navbar-logo"></li>
            <li class="navbar-title">Carolinian Council Choice</li>
        </ul>
        <ul class = "rightLinks">
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="..\aboutus\AboutUs.html">About</a></li>
            <li><a href="..\contactus\ContactUs.html">Contact Us</a></li>
            <li><a href="..\faq\FAQ.html">FAQ</a></li>
            <li>
                <div class="user-info">
                    <img src="" alt="User Profile Picture" class="user-profile-pic">
                    <span class="user-name"></span>
                </div>
            </li>
        </ul> 
    </nav>

    <div class = "mainWrapper">
        <img class = "Backgroundimg" src = "..\..\components\Images\White Background Green.png">

        <div class = "sideBar">
            <div class = "userInfoSideBar">
                <div class = "userPic"></div>
                <p class = "userName">[userNamePlaceHolder]</p>
                <p class = "userType">[userTypePlaceHolder]</p>
                <p class = "votingStatusTitle">Voting Status: </p>
                <p class = "userVotingStatus">[userVotingStatusPlaceHolder]</p>
            </div>
            <div class="menuSelect">
                <a href="#dashboard" class="menuTab">
                    <img src="..\..\components\Images\Dashboard Logo.png" alt="DashboardLogo" class="menuTabLogo">
                    <p class="menuTabTitle">Dashboard</p>
                </a>
                <a href="#vote" class="menuTab">
                    <img src="..\..\components\Images\Vote Logo.png" alt="VoteLogo" class="menuTabLogo">
                    <p class="menuTabTitle">Vote</p>
                </a>
                <a href="#settings" class="menuTab">
                    <img src="..\..\components\Images\Settings Logo.png" alt="SettingsLogo" class="menuTabLogo">
                    <p class="menuTabTitle">Settings</p>
                </a>
                <a href="..\pages\loginpage\login.html" class="menuTab">
                    <img src="..\..\components\Images\Logout Logo.png" alt="LogoutLogo" class="menuTabLogo">
                    <p class="menuTabTitle">Log out</p>
                </a>
            </div>
        </div>
        
    <section id="dashboard" class="content">
        <div class = "midBar">
            <div class="ongoingElecBox">
                <div class="midBoxHeader">
                    <p class="midBoxText">Ongoing Elections</p>
                </div>
                <button class="newsAndUpdatesButton">News and Updates</button>
            </div>

            <div class = "liveResultsBox">
                <div class = "midBoxHeader">
                    <p class = midBoxText>Live Results</p>
                </div>
                <button class = "electionResultsButton">Election Results</button>
            </div>

            <div class = "electionTimeBox">
                <div class = "midBoxHeader">
                    <p class = midBoxText>Election Timeline</p>
                </div>
            </div>
        </div>
    </section>

    <section id="vote" class="content">
        <p>*Voting page</p>
    </section>

    <section id="settings" class="content">
        <div class="allsettings">
            <div class="accBox">
                <h1>Account Information</h1>

                <div class="accdet">
                    <label for="name">Name</label>
                    <input type="text" id="name" value="John Doe" readonly>
                </div>
                <div class="accdet">
                    <label for="idNumber">ID Number</label>
                    <input type="text" id="idNumber" value="" readonly>
                </div>
                <div class="accdet">
                    <label for="status">Status</label>
                    <input type="text" id="status" value="" readonly>
                </div>
                <div class="accdet">
                    <label for="yearLevel">Year Level</label>
                    <input type="text" id="yearLevel" value="" readonly>
                </div>
                <div class="accdet">
                    <label for="department">Department</label>
                    <input type="text" id="department" value="" readonly>
                </div>
                <div class="accdet">
                    <label for="course">Course</label>
                    <input type="text" id="course" value="" readonly>
                </div>
                    <button class="btn">Change Password</button>
                    <button class="btn">Change Profile Picture</button>
            </div>

            <div class="extras">
                <a href="..\privacypolicy\privacypolicy.html">
                    <button class="btn">Privacy Policy</button>
                  </a>
                  <a href="..\termsofservice\TermsOfService.html">
                    <button class="btn">Terms Of Service</button>
                  </a>
            </div>

    </section>

        <img class = "USClogo" src = "..\..\components\Images\Right USC Logo.png">
    </div>


    <footer class = "FooterBox">
        <div class = "footerContainer"></div>
            <img class = "FooterLogo" src = "..\..\components\Images\LogoCCC.png">
            <p class = "SiteName">Carolinian Council Choice</p>
            <p class = "Copyright">Â© 2024 Web 1</p>
        
            <div class="socialIcons">
                    <a href=""><i class="fa-brands fa-facebook"></i></a>
                    <a href=""><i class="fa-brands fa-instagram"></i></a>
                    <a href=""><i class="fa-brands fa-twitter"></i></a>
                    <a href=""><i class="fa-brands fa-youtube"></i></a>
            </div>
        </div>
    </footer>


    <script type="text/javascript">
        const { createClient } = supabase;
        const supabaseUrl = 'https://qbdvzhavzxgjdgctnzoe.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFiZHZ6aGF2enhnamRnY3Ruem9lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTY3OTM1MjIsImV4cCI6MjAzMjM2OTUyMn0.NyzChModofn6DKXkbQ4GU-TPdDccvxAtsuKuj9puK4c';
        const connection = createClient(supabaseUrl, supabaseKey);

                // Function to handle user sign-in
        async function signInUser(email, password) {
        try {
            const { user, error } = await connection.auth.signInWithPassword({
            email: email,
            password: password,
            });

            if (error) {
            console.error('Error signing in:', error);
            } else {
            console.log('User signed in:', user);
            // Fetch user data after successful sign-in
            fetchUserData();
            }
        } catch (error) {
            console.error('Error:', error);
        }
        }

        // Function to fetch user data
        async function fetchUserData() {
        const { data: { user } } = await connection.auth.getUser();

        if (user) {
            try {
            // Fetch the user's data from the database
            const { data, error } = await connection
                .from('user_table')
                .select('firstName, lastName, userType, voteStatus')
                .eq('user_id', user.id)
                .single();

            if (error) {
                console.error('Error fetching user data:', error);
            } else {
                // Update the respective elements with the fetched data
                const userNameElement = document.querySelector('.userName');
                userNameElement.textContent = `${data.firstName} ${data.lastName}`;

                const userTypeElement = document.querySelector('.userType');
                userTypeElement.textContent = data.userType;

                const userVotingStatusElement = document.querySelector('.userVotingStatus');
                userVotingStatusElement.textContent = data.voteStatus;
            }
            } catch (error) {
            console.error('Error:', error);
            }
        } else {
            console.log('User is not authenticated');
        }
        }

                // Add event listener to the form
        const loginForm = document.querySelector('form');
        loginForm.addEventListener('submit', async (event) => {
        event.preventDefault(); // Prevent the default form submission

        const emailInput = document.querySelector('input[name="email"]');
        const passwordInput = document.querySelector('input[name="password"]');

        const email = emailInput.value;
        const password = passwordInput.value;

        // Validate if all fields are filled out
        if (!email || !password) {
            alert('Please fill out all fields.');
            return;
        }

        // Call the signInUser function with the user's email and password
        await signInUser(email, password);
        });
    </script>
</body>
</html>
