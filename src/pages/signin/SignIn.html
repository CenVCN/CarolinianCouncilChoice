<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="SignIn_style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
</head>
<body>
    <div class="mainWrapper">
        <img src="..\..\components\Images\White Background Green.png" class="Backgroundimg" alt="Backgroundimg">
        <img class = "USClogo" src = "..\..\components\Images\Right USC Logo.png">
        <div class="leftSection">
            <p class="CCC">Carolinian Council Choice</p>
            <p class="CCCDesc">An Online Voting System for Carolinians by Carolinians.</p>
            <img class="SSClogo" src="..\..\components\Images\SSC Logo.png">
        </div>
        <div class="signInBox">
            <p class = "signInText">SIGN IN</p>
            <p class = "signInDesc">Be a wise voter</p>
            <form>
                <div class="form-column">
                    <div class="form-group full-width">
                        <label for="email">USC Email</label>
                        <input type="email" id="email"  name="email">
                    </div>
                </div>
                <div class="form-column">
                    <div class="form-group full-width">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password">
                    </div>
                </div>
                <a href = "..\forgotpass\ForgotPass.html">
                    <p class = "forgotPassText">Forgot Password?</p>
                </a>
                <button class = "signInButton" onclick="signIn(event)">Sign In</button>
                <a href="..\signup\SignUp.html" class="SignupRegisterBtn" onclick="redirectToSignUpPage()">Register as a Voter</a>
            </form>
        </div>
    </div>


    <script type ="text/javascript">
        const {createClient} = supabase; //createClient - a function provided by supabase, available once we created the script tag

        const supabase_url = 'https://sqwozgbfzscbetdxgqin.supabase.co'
        const supabase_key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNxd296Z2JmenNjYmV0ZHhncWluIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTY3MjczNzUsImV4cCI6MjAzMjMwMzM3NX0.TUfDeHyKa0ffOms8Agipn9HkZX5OQg9qufygi4E_f90'

        const connection = createClient(supabase_url, supabase_key);

        console.log(connection);

        async function signIn(event) {
            try {
                // Get the user's email and password from the form
                event.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                // Use Supabase's `from` method to access the "user" table
                const { data, error } = await connection.from('user')
                .select('*')
                .eq('uscEmail', email)
                .eq('password', password)
                .single();

                if (error) {
                console.error(error);
                alert('Error signing in. Please check your email and password.');
                authStatus = "Off";
                } else {
                // If the user is found, store the user data in local storage or session storage
                localStorage.setItem('user', JSON.stringify(data));
                alert('Sign in successful!');
                authStatus = "On";
                // Redirect the user to the dashboard or another page
                window.location.href = '../dashboard/dashboard.html';
                }
            } catch (error) {
                console.error(error);
                alert('An unexpected error occurred. Please try again later.');
                authStatus = "Off";
            }
        }


        function redirectToSignUpPage() {
            window.location.href = "..\signup\SignUp.html";
        }
    </script>
</body>
</html>
